# ElasticSearch on the Vert.x Event Bus


## Configuration

The configuration options are as follows:

```json
{
    "address": <address>,
    "transportAddresses": [ { "hostname": <hostname>, "port": <port> } ]
    "cluster_name": <cluster_name>,
    "client_transport_sniff": <client_transport_sniff>
}
```

* `address` - The event bus address to listen on.  The default is `"et.vertx.elasticsearch"`.
* `transportAddress` - An array of transport address objects containing `hostname` and `port`.  If no transport address are provided the default is `"localhost"` and `9300`
    * `hostname` - the ip or hostname of the node to connect to.
    * `port` - the port of the node to connect to.  The default is `9300`.
* `cluster_name` - the elastic search cluster name.  The default is `"elasticsearch"`.
* `client_transport_sniff` - the client will sniff the rest of the cluster and add those into its list of machines to use.  The default is `true`.

An example configuration would be:

```json
{
    "address": "eb.elasticsearch",
    "transportAddress": [ { "hostname": "host1", "port": 9300 }, { "hostname": "host2", "port": 9301 } ],
    "cluster_name": "my_cluster",
    "client_transport_sniff": true
}
```

NOTE: No configuration is needed if running elastic search locally with the default cluster name.



## Action Commands

### Index

http://www.elasticsearch.org/guide/reference/api/index_/

Send a json message to the event bus with the following structure:

```json
{
    "action": "index",
    "index": <index>,
    "type": <type>,
    "id": <id>,
    "source": <source>
}
```

* `index` - the index name.
* `type` - the type name.
* `id` - the string id of the source to insert/update.  This is optional, if missing a new id will be generated by elastic search and returned.
* `source` - the source json document to index

An example message would be:

```json
{
    "action": "index",
    "index": "twitter",
    "type": "tweet",
    "id": "1",
    "source": {
        "user": "englishtown",
        "message": "love elastic search!"
    }
}
```

The event bus replies with a json message with the following structure:

```json
{
    "index": <index>,
    "type": <type>,
    "id": <id>,
    "version" <version>
}
```

* `index` - the index where the source document is stored
* `type` - the type of source document
* `id` - the string id of the indexed source document
* `version` - the numeric version of the source document starting at 1.

An example reply message would be:

```json
{
    "index": "twitter",
    "type": "tweet",
    "id": "1",
    "version": 1
}
```


### Get

http://www.elasticsearch.org/guide/reference/api/get/

Send a json message to the event bus with the following structure:

```json
{
    "action": "get",
    "index": <index>,
    "type": <type>,
    "id": <id>
}
```

* `index` - the index name.
* `type` - the type name.
* `id` - the string id of the source to get.

An example message would be:

```json
{
    "action": "get",
    "index": "twitter",
    "type": "tweet",
    "id": "1"
}
```

The event bus replies with a json message with the following structure:

```json
{
    "index": <index>,
    "type": <type>,
    "id": <id>,
    "version": <version>
    "source": <source>
}
```

* `index` - the index name.
* `type` - the type name.
* `id` - the string id of the source to insert/update.  This is optional, if missing a new id will be generated by elastic search and returned.
* `version` - the numeric version of the source document starting at 1.
* `source` - the source json document to index

An example message would be:

```json
{
    "index": "twitter",
    "type": "tweet",
    "id": "1",
    "version": 1
    "source": {
        "user": "englishtown",
        "message": "love elastic search!"
    }
}
```
